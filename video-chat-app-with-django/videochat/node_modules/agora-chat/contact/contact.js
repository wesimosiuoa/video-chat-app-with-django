"use strict";!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.websdk=t():e.websdk=t()}(self,(function(){return(self.webpackChunkwebsdk=self.webpackChunkwebsdk||[]).push([[564],{7479:function(e,t,r){r.r(t),r.d(t,{acceptContactInvite:function(){return D},acceptInvitation:function(){return G},addContact:function(){return B},addConversationMark:function(){return me},addReaction:function(){return ee},addToBlackList:function(){return H},addUsersToBlacklist:function(){return F},addUsersToBlocklist:function(){return q},declineContactInvite:function(){return K},declineInvitation:function(){return J},deleteAllMessagesAndConversations:function(){return Te},deleteContact:function(){return X},deleteConversation:function(){return b},deleteReaction:function(){return te},deleteSession:function(){return N},fetchHistoryMessages:function(){return Z},fetchUserInfoById:function(){return O},getAllContacts:function(){return de},getBlacklist:function(){return S},getBlocklist:function(){return E},getContacts:function(){return I},getContactsWithCursor:function(){return he},getConversationlist:function(){return R},getHistoryMessages:function(){return z},getReactionDetail:function(){return ne},getReactionList:function(){return re},getReactionlist:function(){return ae},getRoster:function(){return k},getSelfIdsOnOtherPlatform:function(){return ye},getServerConversations:function(){return ie},getServerConversationsByFilter:function(){return ve},getServerPinnedConversations:function(){return ue},getServerPinnedMessages:function(){return Ie},getSessionList:function(){return C},getTokenExpireTimestamp:function(){return M},modifyMessage:function(){return $},pinConversation:function(){return le},pinMessage:function(){return Ee},recallMessage:function(){return Y},removeConversationMark:function(){return ge},removeFromBlackList:function(){return W},removeHistoryMessages:function(){return se},removeRoster:function(){return L},removeUserFromBlackList:function(){return V},removeUserFromBlocklist:function(){return Q},reportMessage:function(){return oe},setContactRemark:function(){return pe},unpinMessage:function(){return ke},updateCurrentUserNick:function(){return U},updateOwnUserInfo:function(){return w},updateUserInfo:function(){return P},uploadPushToken:function(){return A},uploadToken:function(){return _}}),r(9601),r(1539),r(8674),r(2526),r(1817),r(2165),r(6992),r(8783),r(3948),r(9554),r(4747),r(2222),r(7941),r(6699),r(3710),r(9714),r(9600),r(5069),r(561),r(9753),r(8309),r(1249),r(7327);var a=r(3246),n=r(5531),o=r(7252),s=r(4024),i=r(9937),c=r(8161),u=r(4188),l=r.n(u),p=r(7360),d=r(1595),h=r(4363),f=r(7288),m=r(9743),g=function(){return g=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},g.apply(this,arguments)},v=function(e,t,r,a){return new(r||(r=Promise))((function(n,o){function s(e){try{c(a.next(e))}catch(e){o(e)}}function i(e){try{c(a.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,i)}c((a=a.apply(e,t||[])).next())}))},y=function(e,t){var r,a,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,a&&(n=2&o[0]?a.return:o[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,o[1])).done)return n;switch(a=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,a=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],a=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},T={singleChat:"chat",chatRoom:"chatroom",groupChat:"groupchat"};function S(e){if(!a.XZ.call(this)){var t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(t)}var r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l={url:this.apiUrl+"/"+i+"/"+c+"/users/"+this.user+"/blocks/users",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+u},success:function(t){var r={};t.data.forEach((function(e){r[e]={name:e}})),"function"==typeof(null==e?void 0:e.success)&&e.success(t)},error:function(t){"function"==typeof(null==e?void 0:e.error)&&e.error(t)}};return p.kg.debug("Call getBlocklist"),s.hj.call(this,l,d.fI.GET_BLACK_LIST)}var E=S,k=I;function I(e){var t=this;if(!a.XZ.call(this)){var r=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(r)}var i=this.context,c=i.orgName,u=i.appName,l=i.accessToken,h={url:this.apiUrl+"/"+c+"/"+u+"/users/"+this.user+"/contacts/users",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+l},success:function(r){var a=[];r.data.forEach((function(e){a.push({name:e,subscription:"both",jid:t.context.jid})})),"function"==typeof(null==e?void 0:e.success)&&e.success(a)},error:function(t){"function"==typeof(null==e?void 0:e.error)&&e.error(t)}};return p.kg.debug("Call getContacts"),s.hj.call(this,h,d.fI.GET_CONTACTS)}function _(e){if("string"!=typeof e.deviceId||""===e.deviceId)throw Error('Invalid parameter: "deviceId"');if("string"!=typeof e.deviceToken||""===e.deviceToken)throw Error('Invalid parameter: "deviceToken"');if("string"!=typeof e.notifierName||""===e.notifierName)throw Error('Invalid parameter: "notifierName"');if(!a.XZ.call(this)){var t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(t)}var r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/users/").concat(this.user),type:"PUT",data:JSON.stringify({device_id:e.deviceId,device_token:e.deviceToken,notifier_name:e.notifierName}),dataType:"json",headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"},success:e.success,error:e.error};return p.kg.debug("Call uploadPushToken",e),s.hj.call(this,l,d.fI.UPLOAD_PUSH_TOKEN)}var A=_;function C(e){if(!a.XZ.call(this)){var t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(t)}var r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/users/").concat(this.user,"/user_channels"),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"},success:e&&(null==e?void 0:e.success),error:e&&(null==e?void 0:e.error)};return p.kg.debug("Call getSessionList"),s.hj.call(this,l,d.fI.GET_SESSION_LIST)}function R(e){var t=this;if(!a.XZ.call(this)){var r=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(r)}var i=this.context,c=i.orgName,u=i.appName,l=i.accessToken,h=!!(e&&"number"==typeof e.pageNum&&"number"==typeof e.pageSize&&e.pageNum>0&&e.pageSize>0),f={url:"".concat(this.apiUrl,"/").concat(c,"/").concat(u,"/users/").concat(this.user,"/user_channels").concat(h?"/page":""),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+l,"Content-Type":"application/json"},success:e&&(null==e?void 0:e.success),error:e&&(null==e?void 0:e.error)};return h&&(f.data={pageNum:e.pageNum,pageSize:e.pageSize}),p.kg.debug("Call getConversationlist"),s.hj.call(this,f,d.fI.GET_SESSION_LIST).then((function(e){return j.call(t,e)}))}function j(e){var t=this,r=e.data.channel_infos;return null==r||r.forEach((function(e){e.meta&&"{}"!==JSON.stringify(e.meta)?(e.meta.payload=JSON.parse(e.meta.payload),e.lastMessage=h.w.call(t,e.meta,{formatCustomExts:!1})):e.lastMessage=e.meta,delete e.meta})),e}function N(e){if(e&&"string"!=typeof e.channel)throw Error("Invalid parameter channel: ".concat(e.channel));if(e&&"singleChat"!==e.chatType&&"groupChat"!==e.chatType)throw Error("Invalid parameter chatType: ".concat(e.chatType));if(e&&"boolean"!=typeof e.deleteRoam)throw Error("Invalid parameter deleteRoam: ".concat(e.deleteRoam));if(!a.XZ.call(this)){var t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(t)}var r,i=this.context,c=i.orgName,u=i.appName,l=i.accessToken,h=i.jid;r="singleChat"===e.chatType?"chat":"groupChat";var f={url:"".concat(this.apiUrl,"/").concat(c,"/").concat(u,"/user/").concat(this.user,"/user_channel?resource=").concat(h.clientResource),dataType:"json",type:"DELETE",data:JSON.stringify({channel:e.channel,type:r,delete_roam:e.deleteRoam}),headers:{Authorization:"Bearer "+l,"Content-Type":"application/json"},success:e.success,error:e.error};return p.kg.debug("Call deleteSession",e),s.hj.call(this,f,d.fI.DELETE_SESSION)}var b=N;function w(e,t){if(!a.XZ.call(this)){var r=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(r)}var i=this.context,c=i.orgName,u=i.appName,l=i.accessToken,h=["nickname","avatarurl","mail","phone","gender","sign","birth","ext"],f={},m=s.P6.getEnvInfo();if("wx"===m.platform||"qq"===m.platform)if("string"==typeof e&&void 0!==t){if(!h.includes(e))throw new Error("illegal key, only these keys: nickname, avatarurl, mail, phone, gender, sign, birth, ext are allowed");f[e]=t}else{if("[object Object]"!==Object.prototype.toString.call(e))throw new Error("illegal params");h.forEach((function(t){h.includes(t)&&void 0!==e[t]&&(f[t]=e[t])}))}else if("string"==typeof e){if(!h.includes(e))throw new Error("illegal key, only these keys: nickname, avatarurl, mail, phone, gender, sign, birth, ext are allowed");f=e+"="+t}else{if("[object Object]"!==Object.prototype.toString.call(e))throw new Error("illegal params");var g=[];h.forEach((function(t){if(h.includes(t)&&void 0!==e[t]){var r=encodeURIComponent(t),a=encodeURIComponent(e[t]);g.push(r+"="+a)}})),f=g.join("&")}var v={url:"".concat(this.apiUrl,"/").concat(c,"/").concat(u,"/metadata/user/").concat(this.user),type:"PUT",data:f,dataType:"json",headers:{Authorization:"Bearer "+l,"Content-Type":"application/x-www-form-urlencoded"}};return p.kg.debug("Call updateOwnUserInfo",e),s.hj.call(this,v,d.fI.UPDATE_USER_INFO)}var P=w;function O(e,t){if(!a.XZ.call(this)){var r=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(r)}var i,c=this.context,u=c.orgName,l=c.appName,h=c.accessToken,f=[];if("string"==typeof e)f=[e];else{if("[object Array]"!==Object.prototype.toString.call(e))throw new Error("illegal params");f=e}i="string"==typeof t?[t]:t&&"[object Array]"===Object.prototype.toString.call(t)?t:["nickname","avatarurl","mail","phone","gender","sign","birth","ext"];var m={url:"".concat(this.apiUrl,"/").concat(u,"/").concat(l,"/metadata/user/get"),type:"POST",data:JSON.stringify({targets:f,properties:i}),dataType:"json",headers:{Authorization:"Bearer "+h,"Content-Type":"application/json"}};return p.kg.debug("Call fetchUserInfoById",e),s.hj.call(this,m,d.fI.GET_USER_INFO)}function U(e){if(!a.XZ.call(this)){var t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(t)}var r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/users/").concat(this.user),type:"PUT",dataType:"json",data:JSON.stringify({nickname:e}),headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"}};return p.kg.debug("Call updateCurrentUserNick",e),s.hj.call(this,l)}function M(e){if("string"!=typeof e||""===e)throw Error('Invalid parameter: "token"');var t=this.context,r=t.orgName,a=t.appName,n={url:"".concat(this.apiUrl,"/").concat(r,"/").concat(a,"/sdk/users/").concat(this.user,"/token/expires"),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+e,"Content-Type":"application/json"}};return p.kg.debug("Call getTokenExpireTimestamp",e),s.hj.call(this,n,d.fI.SDK_INTERNAL)}function Z(e){var t=this;return new Promise((function(r,s){if(!e.queue)throw Error('Invalid parameter: "specified"');if(!a.XZ.call(t)){var i=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(i)}(function e(t){var a=this,n=t.count||20;x.call(this,{count:n,isGroup:!!t.isGroup,queue:t.queue,start:t.start,format:t.format,success:function(o){if(o.msgs.length>=n||o.is_last){var s=o.msgs.splice(0,n).reverse();t.success&&t.success(s),r(s)}else e.call(a,g(g({},t),{start:null}))},fail:function(e){s(e),t.fail&&t.fail(e)}})}).call(t,e),p.kg.debug("Call fetchHistoryMessages",e)}))}function x(e){var t=this,r=e.queue,a=this.mr_cache[r]||(this.mr_cache[r]={msgs:[]}),i=this.context.userId,u=e.start||-1,p=e.count||20;if(a.msgs.length>=p||a.is_last)"function"==typeof e.success&&e.success(a);else{a&&a.next_key&&(u=a.next_key),e.start&&(u=e.start);var h={queue:r+(e.isGroup?"@conference.easemob.com":"@easemob.com"),start:u,end:-1},f=this.context,m=f.orgName,g=f.appName,T={url:"".concat(this.apiUrl,"/").concat(m,"/").concat(g,"/users/").concat(i,"/messageroaming"),dataType:"json",type:"POST",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"},data:JSON.stringify(h),success:function(r){return v(t,void 0,void 0,(function(){var t,n,o,s,i,u,p=this;return y(this,(function(d){switch(d.label){case 0:if(t=null==r?void 0:r.data,!r.data.msgs)return"function"==typeof e.success&&e.success(a),a.is_last=!0,a.next_key="",[2];n=t.msgs,o=n.length,a.is_last=t.is_last,a.next_key=t.next_key,s=function(t){return v(p,void 0,void 0,(function(){var r,a,n,o,s;return y(this,(function(i){switch(i.label){case 0:for(r=[],t=l().atob(t),a=0,n=t.length;a<n;++a)r.push(t.charCodeAt(a));return o=(o=this.context.root.lookup("easemob.pb.Meta")).decode(r),s={errorCode:0,reason:""},1!==o.ns?[3,2]:[4,c.Z.call(this,o,s,!0,e.format)];case 1:return[2,i.sent()];case 2:return[2]}}))}))},i=0,d.label=1;case 1:return i<o?[4,s(n[i].msg)]:[3,4];case 2:(u=d.sent())&&a.msgs.push(u),d.label=3;case 3:return i++,[3,1];case 4:return"function"==typeof e.success&&e.success(a),[2]}}))}))},error:function(e){if(e.error&&e.error_description){var r=o.Z.create({type:n.E.WEBIM_CONNCTION_AJAX_ERROR,message:"fetch history messages error",data:e});t.onError&&t.onError(r)}}};s.hj.call(this,T,d.fI.GET_HISTORY_MSG).catch((function(t){"function"==typeof e.fail&&e.fail(t)}))}}function z(e){var t=this;return new Promise((function(r,i){var u=e.targetId,d=e.cursor,h=void 0===d?-1:d,f=e.pageSize,m=void 0===f?20:f,g=e.chatType,T=e.searchDirection,S=e.searchOptions,E=void 0===S?{}:S,k=E.msgTypes,I=void 0===k?[]:k,_=E.startTime,A=void 0===_?null:_,C=E.endTime,R=void 0===C?null:C,j=E.from,N=void 0===j?null:j;if("string"!=typeof u||""===u)throw Error('"Invalid parameter": "targetId"');if(N&&"string"!=typeof N)throw Error('"Invalid parameter": "searchOptions.from"');if(I&&!Array.isArray(I))throw Error('"Invalid parameter": "searchOptions.msgTypes"');if(A&&"number"!=typeof A)throw Error('"Invalid parameter": "searchOptions.startTime"');if(R&&"number"!=typeof A)throw Error('"Invalid parameter": "searchOptions.endTime"');if(!a.XZ.call(t)){var b=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return i(b)}var w=t.context,P=w.orgName,O=w.appName,U=w.userId,M="singleChat"===e.chatType?"@easemob.com":"@conference.easemob.com",Z={queue:"".concat(u).concat(M),start:h,pull_number:m,is_positive:"down"===T,msgType:I.join(",")||"",end:-1,startTime:A,endTime:R,userId:"singleChat"===g?null:N},x={url:"".concat(t.apiUrl,"/").concat(P,"/").concat(O,"/users/").concat(U,"/messageroaming"),dataType:"json",type:"POST",headers:{Authorization:"Bearer "+t.token,"Content-Type":"application/json"},data:JSON.stringify(Z),success:function(a){return v(t,void 0,void 0,(function(){var t,n,o,s,i,u,p,d,h=this;return y(this,(function(f){switch(f.label){case 0:t=null==a?void 0:a.data,n=t.msgs||[],o=function(e){return v(h,void 0,void 0,(function(){var t,r,a,n,o;return y(this,(function(s){switch(s.label){case 0:for(t=[],e=l().atob(e),r=0,a=e.length;r<a;++r)t.push(e.charCodeAt(r));return n=(n=this.context.root.lookup("easemob.pb.Meta")).decode(t),o={errorCode:0,reason:""},1!==n.ns?[3,2]:[4,c.Z.call(this,n,o,!0,!0)];case 1:return[2,s.sent()];case 2:return[2]}}))}))},s=[],i=0,f.label=1;case 1:return i<n.length?[4,o(n[i].msg)]:[3,4];case 2:(u=f.sent())&&s.push(u),f.label=3;case 3:return i++,[3,1];case 4:return t.msgs=s,p={cursor:t.next_key,messages:s,isLast:t.is_last},null===(d=e.success)||void 0===d||d.call(e,p),r(p),[2]}}))}))},error:e.fail};s.hj.call(t,x).catch((function(e){i(e)})),p.kg.debug("Call getHistoryMessages",e)}))}function B(e,t){return v(this,void 0,void 0,(function(){var r,i,c,u,l,h,f;return y(this,(function(m){switch(m.label){case 0:if(!a.XZ.call(this))return r=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(r)];if("string"!=typeof e||""===e)throw Error('"Invalid parameter": "to"');return p.kg.debug("Call addContact",e,t),i=this.context,c=i.orgName,u=i.appName,l=i.accessToken,h=i.jid,f={url:"".concat(this.apiUrl,"/").concat(c,"/").concat(u,"/users/").concat(this.user,"/contacts/apply?resource=").concat(h.clientResource),type:"POST",dataType:"json",data:JSON.stringify({usernames:[e],reason:t}),headers:{Authorization:"Bearer "+l,"Content-Type":"application/json"}},[4,s.hj.call(this,f,d.fI.ROSTER_ADD)];case 1:return m.sent(),[2]}}))}))}var L=X;function X(e){return v(this,void 0,void 0,(function(){var t,r,i,c,u,l,h;return y(this,(function(f){switch(f.label){case 0:if(!a.XZ.call(this))return t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(t)];if("string"!=typeof e||""===e)throw Error('"Invalid parameter": "to"');return p.kg.debug("Call deleteContact",e),r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l=r.jid,h={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/users/").concat(this.user,"/contacts/users/").concat(e,"?resource=").concat(l.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"}},[4,s.hj.call(this,h,d.fI.ROSTER_REMOVE)];case 1:return f.sent(),[2]}}))}))}function G(e){return v(this,void 0,void 0,(function(){var t,r,i,c,u,l,h;return y(this,(function(f){switch(f.label){case 0:if(!a.XZ.call(this))return t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(t)];if("string"!=typeof e||""===e)throw Error('"Invalid parameter": "to"');return p.kg.debug("Call acceptInvitation",e),r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l=r.jid,h={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/users/").concat(this.user,"/contacts/accept/users/").concat(e,"?resource=").concat(l.clientResource),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"}},[4,s.hj.call(this,h,d.fI.ROSTER_ACCEPT)];case 1:return f.sent(),[2]}}))}))}var D=G;function J(e){return v(this,void 0,void 0,(function(){var t,r,i,c,u,l,h;return y(this,(function(f){switch(f.label){case 0:if(!a.XZ.call(this))return t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(t)];if("string"!=typeof e||""===e)throw Error('"Invalid parameter": "to"');return p.kg.debug("Call declineInvitation",e),r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l=r.jid,h={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/users/").concat(this.user,"/contacts/decline/users/").concat(e,"?resource=").concat(l.clientResource),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"}},[4,s.hj.call(this,h,d.fI.ROSTER_DECLINE)];case 1:return f.sent(),[2]}}))}))}var K=J;function H(e){return v(this,void 0,void 0,(function(){var t,r,i,c,u,l,h,f,m;return y(this,(function(g){switch(g.label){case 0:if(!a.XZ.call(this))return t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(t)];if(r=e.name,i=[],"string"==typeof r){if(""===r)throw Error('"Invalid parameter": "name"');i=[r]}else{if(!Array.isArray(r))throw Error('"Invalid parameter": "name"');i=r}return p.kg.debug("Call addToBlockList",e),c=this.context,u=c.orgName,l=c.appName,h=c.accessToken,f=c.jid,m={url:"".concat(this.apiUrl,"/").concat(u,"/").concat(l,"/sdk/user/").concat(this.user,"/blocks?resource=").concat(f.clientResource),type:"POST",dataType:"json",data:JSON.stringify({usernames:i}),headers:{Authorization:"Bearer "+h,"Content-Type":"application/json"}},[4,s.hj.call(this,m,d.fI.ROSTER_BAN).then((function(e){return{type:e.type,data:{userIds:(null==e?void 0:e.data)||[]}}}))];case 1:return[2,g.sent()]}}))}))}var F=H,q=H;function W(e){return v(this,void 0,void 0,(function(){var t,r,i,c,u,l,h,f,m;return y(this,(function(g){switch(g.label){case 0:if(!a.XZ.call(this))return t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(t)];if(r=e.name,i=[],"string"==typeof r){if(""===r)throw Error('"Invalid parameter": "name"');i=[r]}else{if(!Array.isArray(r))throw Error('"Invalid parameter": "name"');i=r}return p.kg.debug("Call removeFromBlockList",e),c=this.context,u=c.orgName,l=c.appName,h=c.accessToken,f=c.jid,m={url:"".concat(this.apiUrl,"/").concat(u,"/").concat(l,"/sdk/user/").concat(this.user,"/blocks?resource=").concat(f.clientResource),type:"DELETE",dataType:"json",data:JSON.stringify({usernames:i}),headers:{Authorization:"Bearer "+h,"Content-Type":"application/json"}},[4,s.hj.call(this,m,d.fI.ROSTER_ALLOW)];case 1:return g.sent(),[2]}}))}))}var V=W,Q=W;function Y(e){var t=this,r=(null==e?void 0:e.ext)||"";if("string"!=typeof r)throw Error('"Invalid parameter": "ext"',r);var a=this.getUniqueId(),n={id:a,to:e.to};this._msgHash[a]=g({},n);var o="";void 0!==e.chatType?o=e.chatType:void 0!==e.type&&(o="chat"===e.type?"singleChat":e.type);var s={id:a,type:"recall",chatType:o,ackId:e.mid,to:e.to,isChatThread:e.isChatThread||!1,metaExt:r,success:function(r){return v(t,void 0,void 0,(function(){var t,a,n,s,i,c,u,l,p;return y(this,(function(d){switch(d.label){case 0:return d.trys.push([0,5,,6]),"singleChat"!==o&&"groupChat"!==o?[3,4]:[4,null===(n=null===(a=this._localCache)||void 0===a?void 0:a.getInstance())||void 0===n?void 0:n.removeMsgByServerMsgId(e.mid)];case 1:return d.sent(),[4,null===(i=null===(s=this._localCache)||void 0===s?void 0:s.getInstance())||void 0===i?void 0:i.getConversationLastMessage(e.to,o)];case 2:return t=d.sent(),[4,null===(u=null===(c=this._localCache)||void 0===c?void 0:c.getInstance())||void 0===u?void 0:u.updateLocalConversation((0,m.MQ)({conversationId:e.to,conversationType:o}),{lastMessageId:null==t?void 0:t.serverMsgId})];case 3:d.sent(),d.label=4;case 4:return null===(l=null==e?void 0:e.success)||void 0===l||l.call(e,r),[3,6];case 5:return d.sent(),null===(p=null==e?void 0:e.success)||void 0===p||p.call(e,r),[3,6];case 6:return[2]}}))}))},fail:e.fail};return p.kg.debug("Call recallMessage",e),this.mSync.send(s,this)}function $(e){var t=e||{},r=t.messageId,a=t.modifiedMessage;if(p.kg.debug("Call modifyMessage",r,a),""===r)throw Error('Invalid parameter: "messageId"');if("txt"!==a.type)throw Error('Invalid parameter: "modifiedMessage.type"');return this.mSync.send(g({editMessageId:r},a))}function ee(e){return v(this,void 0,void 0,(function(){var t,r,i,c,u,l,p,d,h;return y(this,(function(f){switch(f.label){case 0:if("string"!=typeof e.messageId||!e.messageId)throw Error("Invalid parameter messageId: ".concat(e.messageId));if("string"!=typeof e.reaction||!e.reaction)throw Error("Invalid parameter reaction: ".concat(e.reaction));return a.XZ.call(this)?(r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l=e.reaction,p=e.messageId,d={msgId:p,message:l},h={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/reaction/user/").concat(this.user),type:"POST",data:JSON.stringify(d),dataType:"json",headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"}},[4,s.hj.call(this,h)]):(t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(t)]);case 1:return f.sent(),[2]}}))}))}function te(e){return v(this,void 0,void 0,(function(){var t,r,i,c,u,l,p,d;return y(this,(function(h){switch(h.label){case 0:if("string"!=typeof e.reaction||!e.reaction)throw Error("Invalid parameter reactionId: ".concat(e.reaction));return a.XZ.call(this)?(r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l=e.messageId,p=e.reaction,d={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/reaction/user/").concat(this.user,"?msgId=").concat(l,"&message=").concat(p),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"}},[4,s.hj.call(this,d)]):(t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(t)]);case 1:return h.sent(),[2]}}))}))}function re(e){if("string"!=typeof e.chatType||!e.chatType)throw Error("Invalid parameter chatType: ".concat(e.chatType));if(!e.messageId)throw Error("Invalid parameter messageId: ".concat(e.messageId));if(!a.XZ.call(this)){var t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(t)}var r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l=e.chatType,p=e.messageId,d={msgIdList:"string"==typeof p?[p]:p,msgType:"singleChat"===l?"chat":"groupchat",groupId:e.groupId||null},h={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/reaction/user/").concat(this.user),type:"GET",data:d,dataType:"json",headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"}};return s.hj.call(this,h).then((function(e){var t=e.data;return null==t||t.forEach((function(e){null==e||e.reactionList.forEach((function(e){e.isAddedBySelf=e.state,delete e.state,delete e.reactionId}))})),e}))}var ae=re;function ne(e){if("string"!=typeof e.reaction||!e.reaction)throw Error("Invalid parameter reaction: ".concat(e.reaction));if("string"!=typeof e.messageId||!e.messageId)throw Error("Invalid parameter messageId: ".concat(e.messageId));if(!a.XZ.call(this)){var t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(t)}var r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l=e.cursor,p=e.pageSize,d={msgId:e.messageId,message:e.reaction,currentPage:l||null,pageSize:p||20},h={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/reaction/user/").concat(this.user,"/detail"),type:"GET",data:d,dataType:"json",headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"}};return s.hj.call(this,h).then((function(e){return e.data.isAddedBySelf=e.data.state,delete e.data.state,delete e.data.reactionId,e}))}function oe(e){return v(this,void 0,void 0,(function(){var t,r,i,c,u,l,p,d,h,f,m;return y(this,(function(g){switch(g.label){case 0:if("string"!=typeof e.reportType||!e.reportType)throw Error("Invalid parameter reportType: ".concat(e.reportType));if("string"!=typeof e.messageId||!e.messageId)throw Error("Invalid parameter messageId: ".concat(e.messageId));if("string"!=typeof e.reportReason||!e.reportReason)throw Error("Invalid parameter messageId: ".concat(e.reportReason));return a.XZ.call(this)?(r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l=e.reportType,p=e.reportReason,d=e.messageId,h={username:this.user,reportType:l,reportReason:p},f="".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/user/").concat(this.user,"/moderation/report/message/").concat(d),m={url:f,type:"POST",data:JSON.stringify(h),dataType:"json",headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"}},[4,s.hj.call(this,m)]):(t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(t)]);case 1:return g.sent(),[2]}}))}))}function se(e){var t;return v(this,void 0,void 0,(function(){var r,i,c,u,l,d,h,f,m;return y(this,(function(g){switch(g.label){case 0:if("string"!=typeof e.targetId||""===e.targetId)throw Error('"Invalid parameter targetId": '+e.targetId);if(!["singleChat","groupChat"].includes(e.chatType))throw Error('"Invalid parameter chatType": '+e.chatType);if(e.beforeTimeStamp&&("number"!=typeof e.beforeTimeStamp||e.beforeTimeStamp<0||(null===(t=e.beforeTimeStamp)||void 0===t?void 0:t.toString().length)>18))throw Error('"Invalid parameter beforeTimeStamp": '+e.beforeTimeStamp);if(e.messageIds&&!(Array.isArray(e.messageIds)&&e.messageIds.length>0&&e.messageIds.length<=20))throw Error('"Invalid parameter messageIds": '+e.messageIds);if(!e.messageIds&&!e.beforeTimeStamp)throw Error("messageIds or beforeTimeStamp field is required.");return a.XZ.call(this)?(i=this.context,c=i.orgName,u=i.appName,l=i.userId,d="singleChat"===e.chatType?"userId":"groupId",h="singleChat"===e.chatType?"chat":"group",f=e.messageIds?"".concat(this.apiUrl,"/").concat(c,"/").concat(u,"/sdk/message/roaming/").concat(h,"/user/").concat(l,"?").concat(d,"=").concat(e.targetId,"&msgIdList=").concat(e.messageIds,"&resource=").concat(this.clientResource):"".concat(this.apiUrl,"/").concat(c,"/").concat(u,"/sdk/message/roaming/").concat(h,"/user/").concat(l,"/time?").concat(d,"=").concat(e.targetId,"&delTime=").concat(e.beforeTimeStamp,"&&resource=").concat(this.clientResource),m={url:f,dataType:"json",type:"DELETE",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}},p.kg.debug("Call removeHistoryMessages",e),[4,s.hj.call(this,m)]):(r=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(r)]);case 1:return g.sent(),[2]}}))}))}function ie(e){var t=this;if(!a.XZ.call(this)){var r=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(r)}if((null==e?void 0:e.pageSize)&&"number"!=typeof e.pageSize)throw Error("Invalid parameter pageSize: ".concat(e.pageSize));if((null==e?void 0:e.cursor)&&"string"!=typeof e.cursor)throw Error("Invalid parameter cursor: ".concat(e.cursor));var i=this.context,c=i.orgName,u=i.appName,l=i.accessToken,h={url:"".concat(this.apiUrl,"/").concat(c,"/").concat(u,"/sdk/user/").concat(this.user,"/user_channels/list?"),type:"GET",dataType:"json",data:{limit:(null==e?void 0:e.pageSize)||20,cursor:(null==e?void 0:e.cursor)||"",need_mark:!0},headers:{Authorization:"Bearer "+l,"Content-Type":"application/json"}};return p.kg.debug("Call getServerConversations",e),new Promise((function(e,r){s.hj.call(t,h,d.fI.GET_SESSION_LIST).then((function(r){return v(t,void 0,void 0,(function(){var t,a=this;return y(this,(function(n){switch(n.label){case 0:return t=ce.call(this,r),this._localCache?[4,Promise.all(t.data.conversations.map((function(e){return v(a,void 0,void 0,(function(){var t,r,a=this;return y(this,(function(n){return null===(r=null===(t=this._localCache)||void 0===t?void 0:t.getInstance())||void 0===r||r.storeMessage(e.lastMessage,f.r.SUCCESS,!0).then((function(){var t,r;null===(r=null===(t=a._localCache)||void 0===t?void 0:t.getInstance())||void 0===r||r.updateLocalConversation((0,m.MQ)({conversationId:e.conversationId,conversationType:e.conversationType}),{unReadCount:e.unReadCount})})),[2]}))}))})))]:[3,2];case 1:return n.sent(),e(t),[2];case 2:return e(t),[2]}}))}))})).catch((function(e){r(e)}))}))}function ce(e){var t=this,r=e.data,a=r.cursor,n=r.channel_infos,o=[];null==n||n.forEach((function(e){var r=null;(null==e?void 0:e.meta)&&"{}"!==JSON.stringify(e.meta)&&(e.meta.payload=JSON.parse(e.meta.payload),"delivery"!==(r=h.w.call(t,e.meta)).type&&"read"!==r.type&&"channel"!==r.type&&(r.chatType=h.U[r.chatType]));var a={conversationId:e.session_to,conversationType:"chat"===e.session_type?"singleChat":"groupChat",isPinned:e.is_top,pinnedTime:e.is_top?e.update_top_status_time:0,unReadCount:e.unread_num,lastMessage:r};e.marks&&(a.marks=e.marks.map((function(e){return i.Z[e]}))),o.push(a)}));var s={conversations:o,cursor:a||""};return{type:e.type,data:s}}function ue(e){var t=this;if(!a.XZ.call(this)){var r=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(r)}if((null==e?void 0:e.pageSize)&&"number"!=typeof e.pageSize)throw Error("Invalid parameter pageSize: ".concat(e.pageSize));if((null==e?void 0:e.cursor)&&"string"!=typeof e.cursor)throw Error("Invalid parameter cursor: ".concat(e.cursor));var i=this.context,c=i.orgName,u=i.appName,l=i.accessToken,h={url:"".concat(this.apiUrl,"/").concat(c,"/").concat(u,"/sdk/user/").concat(this.user,"/user_channels/list?"),type:"GET",dataType:"json",data:{limit:(null==e?void 0:e.pageSize)||20,cursor:(null==e?void 0:e.cursor)||"",is_top:!0,need_mark:!0},headers:{Authorization:"Bearer "+l,"Content-Type":"application/json"}};return p.kg.debug("Call getServerPinnedConversations",e),s.hj.call(this,h,d.fI.GET_SESSION_LIST).then((function(e){return ce.call(t,e)}))}function le(e){return v(this,void 0,void 0,(function(){var t,r,i,c,u,l,h,f,m,g,v,T,S,E;return y(this,(function(y){if(!a.XZ.call(this))return t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(t)];if(r=e.conversationId,i=e.conversationType,c=e.isPinned,u="singleChat"===i?"chat":"groupChat","string"!=typeof r||""===r)throw Error("Invalid parameter conversationId: ".concat(r));if(!["singleChat","groupChat"].includes(i))throw Error("Invalid parameter conversationType: ".concat(i));if("boolean"!=typeof c)throw Error("Invalid parameter isPinned: ".concat(c));return l=this.context,h=l.orgName,f=l.appName,m=l.accessToken,g=l.jid,v={type:u,to:r},T=c?"":"type=".concat(u,"&to=").concat(r,"&"),S="".concat(this.apiUrl,"/").concat(h,"/").concat(f,"/sdk/user/").concat(this.user,"/user_channel/top?").concat(T,"resource=").concat(g.clientResource),E={url:S,type:c?"POST":"DELETE",dataType:"json",headers:{Authorization:"Bearer "+m,"Content-Type":"application/json"}},c&&(E.data=JSON.stringify(v)),p.kg.debug("Call pinConversation",e),[2,s.hj.call(this,E,d.fI.PIN_CONVERSATION).then((function(e){var t=e.type,r=e.data;return{type:t,data:{isPinned:r.is_top||!1,pinnedTime:r.is_top?r.update_top_status_time:0}}}))]}))}))}function pe(e){return v(this,void 0,void 0,(function(){var t,r,i,c,u,l,h,f,m,g;return y(this,(function(v){switch(v.label){case 0:if(t=e.userId,r=e.remark,!a.XZ.call(this))return i=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(i)];if("string"!=typeof t||""===t)throw Error('Invalid parameter: "userId"');if("string"!=typeof r)throw Error('Invalid parameter: "remark"');return p.kg.debug("Call setContactRemark",e),c=this.context,u=c.orgName,l=c.appName,h=c.accessToken,f=c.jid,m="".concat(this.apiUrl,"/").concat(u,"/").concat(l,"/users/").concat(this.context.userId,"/contacts/users/").concat(t,"?resource=").concat(f.clientResource),g={url:m,type:"PUT",data:JSON.stringify({remark:r}),dataType:"json",headers:{Authorization:"Bearer "+h,"Content-Type":"application/json"}},[4,s.hj.call(this,g,d.fI.ROSTER_SET_CONTACT_REMARK)];case 1:return v.sent(),[2]}}))}))}function de(){if(!a.XZ.call(this)){var e=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(e)}var t=this.context,r=t.orgName,i=t.appName,c=t.accessToken,u={url:"".concat(this.apiUrl,"/").concat(r,"/").concat(i,"/users/").concat(this.user,"/contacts/users?needReturnRemark=true"),dataType:"json",type:"GET",headers:{Authorization:"Bearer "+c}};return p.kg.debug("Call getAllContacts"),s.hj.call(this,u,d.fI.ROSTER_GET_ALL_CONTACTS_REMARKS).then((function(e){var t=((null==e?void 0:e.entities)||[]).map((function(e){return{userId:e.username,remark:e.remark}}));return{type:e.type,data:t}}))}function he(e){if(!a.XZ.call(this)){var t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(t)}p.kg.debug("Call getContactsWithCursor",e);var r=e||{},i=r.pageSize,c=void 0===i?20:i,u=r.cursor,l=void 0===u?"":u;if(c&&"number"!=typeof c)throw Error("Invalid parameter pageSize: ".concat(e.pageSize));var h=this.context,f=h.orgName,m=h.appName,g=h.accessToken,v={url:"".concat(this.apiUrl,"/").concat(f,"/").concat(m,"/users/").concat(this.user,"/contacts?needReturnRemark=true&limit=").concat(c,"&cursor=").concat(l),dataType:"json",type:"GET",headers:{Authorization:"Bearer "+g}};return s.hj.call(this,v,d.fI.ROSTER_GET_ALL_CONTACTS_REMARKS_FROM_SERVER_BY_PAGE).then((function(e){var t,r,a=(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.contacts)||[],n=(null===(r=null==e?void 0:e.data)||void 0===r?void 0:r.cursor)||"",o=a.map((function(e){return{userId:e.username,remark:e.remark}}));return{type:e.type,data:{cursor:n,contacts:o}}}))}function fe(e){return v(this,void 0,void 0,(function(){var t,r,c,u,l,f,m,g,v,S,E,k,I,_,A;return y(this,(function(y){switch(y.label){case 0:if(!a.XZ.call(this))return t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(t)];if(p.kg.debug("Call markConversation",e),c=(r=e||{}).conversations,u=void 0===c?[]:c,l=r.mark,f=r.isMarked,!Array.isArray(u))throw Error("Invalid parameter conversations");if(m=u.map((function(e){if(!e.conversationId||!["singleChat","groupChat"].includes(e.conversationType))throw Error("Invalid parameter conversations");return{to:e.conversationId,type:T[e.conversationType]}})),"boolean"!=typeof f)throw Error("Invalid parameter isMarked: ".concat(f));if("number"!=typeof l)throw Error("Invalid parameter mark: ".concat(l));return g=this.context,v=g.orgName,S=g.appName,E=g.accessToken,k=g.userId,I=g.jid,_={mark:i.Z[l],targets:m},A={url:"".concat(this.apiUrl,"/").concat(v,"/").concat(S,"/sdk/user/").concat(k,"/user_channels/mark?resource=").concat(I.clientResource),dataType:"json",data:JSON.stringify(_),type:f?"Post":"Delete",headers:{Authorization:"Bearer "+E}},[4,s.hj.call(this,A,d.fI.MARK_CONVERSATION).then((function(e){var t,r=(null===(t=e.data)||void 0===t?void 0:t.ignore)||[];r&&Array.isArray(r)&&r.length>0&&p.kg.debug("markConversation has ignored conversations",r.map((function(e){return{conversationId:e.to,conversationType:h.U[e.type]}})))}))];case 1:return y.sent(),[2]}}))}))}function me(e){return v(this,void 0,void 0,(function(){var t,r;return y(this,(function(a){return p.kg.debug("Call addConversationMark",e),t=e.conversations,r=e.mark,[2,fe.call(this,{conversations:t,mark:r,isMarked:!0})]}))}))}function ge(e){return v(this,void 0,void 0,(function(){var t,r;return y(this,(function(a){return p.kg.debug("Call removeConversationMark",e),t=e.conversations,r=e.mark,[2,fe.call(this,{conversations:t,mark:r,isMarked:!1})]}))}))}function ve(e){var t,r,c=this;if(!a.XZ.call(this)){var u=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(u)}if(p.kg.debug("Call getServerConversationsByFilter",e),(null==e?void 0:e.pageSize)&&"number"!=typeof e.pageSize)throw Error("Invalid parameter pageSize: ".concat(e.pageSize));if((null==e?void 0:e.cursor)&&"string"!=typeof e.cursor)throw Error("Invalid parameter cursor: ".concat(e.cursor));if("number"!=typeof(null===(t=null==e?void 0:e.filter)||void 0===t?void 0:t.mark))throw Error("Invalid parameter mark: ".concat(null===(r=null==e?void 0:e.filter)||void 0===r?void 0:r.mark));var l=this.context,h=l.orgName,f=l.appName,m=l.accessToken,g="".concat(this.apiUrl,"/").concat(h,"/").concat(f,"/sdk/user/").concat(this.user,"/user_channels/mark/search?"),v=e.pageSize,y=e.cursor,T=((null==e?void 0:e.filter)||{}).mark,S={url:g,type:"GET",dataType:"json",data:{limit:v||10,cursor:y||"",need_mark:!0,mark:i.Z[T]},headers:{Authorization:"Bearer "+m,"Content-Type":"application/json"}};return s.hj.call(this,S,d.fI.GET_SESSION_LIST).then((function(e){return ce.call(c,e)}))}function ye(){if(!a.XZ.call(this)){var e=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(e)}p.kg.debug("Call getSelfIdsOnOtherPlatform");var t=this.context,r=t.orgName,i=t.appName,c=t.accessToken,u=t.userId,l=t.jid,h={url:"".concat(this.apiUrl,"/").concat(r,"/").concat(i,"/users/").concat(u,"/resources"),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+c,"Content-Type":"application/json"}};return s.hj.call(this,h,d.fI.USER_LOGGEDIN_OTHER_PLATFORM).then((function(e){var t,r=null===(t=e.data)||void 0===t?void 0:t.filter((function(e){return e.res!==l.clientResource})),a=null==r?void 0:r.map((function(e){return"".concat(u,"/").concat(e.res)}));return{type:e.type,data:a}}))}function Te(){var e,t,r,i,c,u;return v(this,void 0,void 0,(function(){var l,h,f,m,g,v,T,S,E;return y(this,(function(y){switch(y.label){case 0:return a.XZ.call(this)?(p.kg.debug("Call deleteAllMessagesAndConversations"),h=this.context,f=h.orgName,m=h.appName,g=h.accessToken,v=h.userId,T=h.jid,S="".concat(this.apiUrl,"/").concat(f,"/").concat(m,"/sdk/message/roaming/user/").concat(v,"/delete/all?resource=").concat(T.clientResource),E={url:S,type:"POST",dataType:"json",headers:{Authorization:"Bearer "+g,"Content-Type":"application/json"}},[4,s.hj.call(this,E,d.fI.REST_DELETE_MESSAGES_CONVERSATIONS)]):(l=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(l)]);case 1:return y.sent(),null===(t=null===(e=this._localCache)||void 0===e?void 0:e.getInstance())||void 0===t||t.clearConversationMap(),[4,null===(i=null===(r=this._localCache)||void 0===r?void 0:r.getInstance())||void 0===i?void 0:i.clearStoreData("conversationList")];case 2:return y.sent(),[4,null===(u=null===(c=this._localCache)||void 0===c?void 0:c.getInstance())||void 0===u?void 0:u.clearStoreData("message")];case 3:return y.sent(),[2]}}))}))}function Se(e){return v(this,void 0,void 0,(function(){var t,r,i,c,u,l,h,f,m,g,v,S,E,k,I;return y(this,(function(y){switch(y.label){case 0:if(!a.XZ.call(this))return t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(t)];if(p.kg.debug("Call setMessagePinStatus",e),i=(r=e||{}).conversationId,c=void 0===i?"":i,u=r.conversationType,l=r.messageId,h=r.isPinned,"string"!=typeof c||""===c)throw Error("Invalid parameter conversationId");if("string"!=typeof l||""===l)throw Error("Invalid parameter messageId");if("boolean"!=typeof h)throw Error("Invalid parameter isPinned");return f=this.context,m=f.orgName,g=f.appName,v=f.accessToken,S=f.userId,E=f.jid,k={to:c,type:T[u],pin_msg_id:l},I={url:"".concat(this.apiUrl,"/").concat(m,"/").concat(g,"/sdk/user/").concat(S,"/user_channel/pin?resource=").concat(E.clientResource),dataType:"json",data:JSON.stringify(k),type:h?"Post":"Delete",headers:{Authorization:"Bearer "+v}},[4,s.hj.call(this,I,d.fI.REST_PIN_MESSAGE)];case 1:return y.sent(),[2]}}))}))}function Ee(e){return v(this,void 0,void 0,(function(){var t,r,a,n;return y(this,(function(o){return p.kg.debug("Call pinMessage",e),r=(t=e||{}).conversationType,a=t.conversationId,n=t.messageId,[2,Se.call(this,{conversationId:a,conversationType:r,messageId:n,isPinned:!0})]}))}))}function ke(e){return v(this,void 0,void 0,(function(){var t,r,a,n;return y(this,(function(o){return p.kg.debug("Call unpinMessage",e),r=(t=e||{}).conversationType,a=t.conversationId,n=t.messageId,[2,Se.call(this,{conversationId:a,conversationType:r,messageId:n,isPinned:!1})]}))}))}function Ie(e){var t=this;if(!a.XZ.call(this)){var r=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(r)}p.kg.debug("Call getServerPinnedMessages",e);var i=e.conversationId,c=e.conversationType,u=e.pageSize,l=e.cursor;if("string"!=typeof i||""===i)throw Error("Invalid parameter conversationId");if(u&&"number"!=typeof u)throw Error("Invalid parameter pageSize: ".concat(u));if(l&&"string"!=typeof l)throw Error("Invalid parameter cursor: ".concat(l));var f=this.context,m=f.orgName,g=f.appName,v=f.accessToken,y={url:"".concat(this.apiUrl,"/").concat(m,"/").concat(g,"/sdk/user/").concat(this.user,"/user_channel/pin"),type:"GET",dataType:"json",data:{to:i,type:T[c],limit:u||10,cursor:l||""},headers:{Authorization:"Bearer "+v,"Content-Type":"application/json"}};return s.hj.call(this,y,d.fI.GET_SESSION_LIST).then((function(e){return{type:0,data:{list:e.data.msg_infos.map((function(e){e.message.payload=JSON.parse(e.message.payload);var r=e.message,a=e.pin_opt_at,n=e.pin_operator;return{message:h.w.call(t,r,{formatChatType:!0}),pinTime:a,operatorId:n}})),cursor:e.data.cursor||""}}}))}},3246:function(e,t,r){r.d(t,{H7:function(){return u},XZ:function(){return i},_W:function(){return c}}),r(7941),r(9554),r(1539),r(4747),r(6699),r(2023);var a=r(5531),n=r(7252);function o(){var e=this.context.appName,t=this.context.orgName;return!(!e||!t)||(this.onError&&this.onError({type:a.E.WEBIM_CONNCTION_AUTH_ERROR,message:"appName or orgName is illegal"}),!1)}function s(){var e;if(!this.context.accessToken){var t=n.Z.create({type:a.E.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR,message:"token not assign error"});return this.onError&&this.onError(t),null===(e=this.eventHandler)||void 0===e||e.dispatch("onError",t),!1}return!0}function i(){return s.call(this)&&o.call(this)}function c(e){var t=e.data,r=e.type;return{data:{status:Object.keys(t.errorKeys).length>0?"fail":"success",errorKeys:t.errorKeys,successKeys:t.successKeys},type:r}}function u(e){var t=e.data,r=void 0;return Object.keys(t.errorKeys).length>0&&Object.keys(t.errorKeys).forEach((function(e){var o=t.errorKeys[e];r=o.includes("is not part of you")?n.Z.create({type:a.E.NO_PERMISSION,message:o}):o.includes("size of metadata for this single chatroom exceeds the user defined limit")||o.includes("total size of chatroom metadata for this app exceeds the user defined limit")||o.includes("is exceeding maximum limit")?n.Z.create({type:a.E.MAX_LIMIT,message:o}):o.includes("is not Legal")?n.Z.create({type:a.E.REQUEST_PARAMETER_ERROR,message:o}):o.includes("Failed to update userMetadata. Concurrent updates not allowed")?n.Z.create({type:a.E.OPERATION_NOT_ALLOWED,message:o}):n.Z.create({type:a.E.WEBIM_CONNCTION_AJAX_ERROR,message:o})})),r}},5069:function(e,t,r){var a=r(2109),n=r(1702),o=r(3157),s=n([].reverse),i=[1,2];a({target:"Array",proto:!0,forced:String(i)===String(i.reverse())},{reverse:function(){return o(this)&&(this.length=this.length),s(this)}})}},function(e){return 7479,e(e.s=7479)}])}));